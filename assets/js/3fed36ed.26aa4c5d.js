"use strict";(self.webpackChunkgiveth_docs=self.webpackChunkgiveth_docs||[]).push([[1158],{3905:(e,t,a)=>{a.d(t,{Zo:()=>h,kt:()=>d});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},h=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),p=c(a),d=o,m=p["".concat(l,".").concat(d)]||p[d]||u[d]||i;return a?n.createElement(m,r(r({ref:t},h),{},{components:a})):n.createElement(m,r({ref:t},h))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=a[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},173:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>h});var n=a(7462),o=(a(7294),a(3905)),i=a(4996);const r={id:"devouch-api",title:"Integrating DeVouch",slug:"/integrating-devouch"},s=void 0,l={unversionedId:"devouch-api",id:"devouch-api",title:"Integrating DeVouch",description:"DeVouch prioritizes accessiblity of information and easy integration. Reading and writing data to DeVouch is accessible to all! We have three topics to cover in this article:",source:"@site/devouch/api.md",sourceDirName:".",slug:"/integrating-devouch",permalink:"/devouch/integrating-devouch",draft:!1,editUrl:"https://github.com/giveth/giveth-docs/edit/master/devouch/api.md",tags:[],version:"current",lastUpdatedBy:"Amin Latifi",lastUpdatedAt:1718288098,formattedLastUpdatedAt:"Jun 13, 2024",frontMatter:{id:"devouch-api",title:"Integrating DeVouch",slug:"/integrating-devouch"},sidebar:"whatisdevouch",previous:{title:"What is DeVouch?",permalink:"/devouch/"}},c={},h=[{value:"How to issue DeVouch attestations",id:"how-to-issue-devouch-attestations",level:2},{value:"Make the Attestation Onchain",id:"make-the-attestation-onchain",level:3},{value:"No recipient address",id:"no-recipient-address",level:3},{value:"Project Source",id:"project-source",level:3},{value:"Project Id",id:"project-id",level:3},{value:"Giveth",id:"giveth",level:4},{value:"Gitcoin",id:"gitcoin",level:4},{value:"Retro Funding 4",id:"retro-funding-4",level:4},{value:"Vouch",id:"vouch",level:3},{value:"Comment",id:"comment",level:3},{value:"Referenced Attestations",id:"referenced-attestations",level:3},{value:"Ready to submit!",id:"ready-to-submit",level:3},{value:"Adding your Attester Group to DeVouch",id:"adding-your-attester-group-to-devouch",level:2},{value:"Overview of the DeVouch Graphql API &amp; Cookbook",id:"overview-of-the-devouch-graphql-api--cookbook",level:2}],u={toc:h};function p(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"DeVouch prioritizes accessiblity of information and easy integration. Reading and writing data to DeVouch is accessible to all! We have three topics to cover in this article:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"How to issue DeVouch attestations "),(0,o.kt)("li",{parentName:"ul"},"Adding your Attester Group to DeVouch"),(0,o.kt)("li",{parentName:"ul"},"Overview of the DeVouch Graphql API & Cookbook")),(0,o.kt)("h2",{id:"how-to-issue-devouch-attestations"},"How to issue DeVouch attestations"),(0,o.kt)("p",null,"There is a standardized attestation schema that all DeVouch eligible attestations MUST USE. You can find them here: "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://sepolia.easscan.org/schema/view/0x97b0c9911936fad57e77857fac6eef6771f8d0bf025be9549214e32bf9e2415a"},"Sepolia (for testing)")," "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://optimism.easscan.org/schema/view/0x97b0c9911936fad57e77857fac6eef6771f8d0bf025be9549214e32bf9e2415a"},"Optimism Mainnet"))),(0,o.kt)("p",null,"We recommend using the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ethereum-attestation-service/eas-sdk"},"EAS SDK")," to integrate making attestations from your application, but for demonstration purposes we will show you how it looks on the easscan UI."),(0,o.kt)("img",{alt:"easscan view of devouch attestation",src:(0,i.Z)("img/devouch/devouchAttestationExample.png")}),(0,o.kt)("h3",{id:"make-the-attestation-onchain"},"Make the Attestation Onchain"),(0,o.kt)("p",null,"You need to set the attestation as onchain in order for it to be indexed by DeVouch."),(0,o.kt)("h3",{id:"no-recipient-address"},"No recipient address"),(0,o.kt)("p",null,"You don't need to set a recipient address for DeVouch attestations."),(0,o.kt)("h3",{id:"project-source"},"Project Source"),(0,o.kt)("p",null,"This is the name of the source platform that the project is from, currently there are these three: ",(0,o.kt)("inlineCode",{parentName:"p"},"gitcoin"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"giveth"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"rf4")," (Retro Funding round 4). More source platforms may be added later."),(0,o.kt)("h3",{id:"project-id"},"Project Id"),(0,o.kt)("p",null,"Project identifier (ID) from the source platform. This is the unique identifier for the project on the source platform."),(0,o.kt)("h4",{id:"giveth"},"Giveth"),(0,o.kt)("p",null,"For Giveth projects you can find the id of a project by going to the ",(0,o.kt)("a",{parentName:"p",href:"https://mainnet.serve.giveth.io/graphql"},"Giveth graphQL API")," and running a query like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},'query { \n  projectBySlug(slug: "project/slug/goes/here") {\n    id\n    title\n  }\n}\n')),(0,o.kt)("p",null,"This will give you a number like ",(0,o.kt)("inlineCode",{parentName:"p"},"12345")," that you should use for the project Id when attesting to a Giveth project."),(0,o.kt)("h4",{id:"gitcoin"},"Gitcoin"),(0,o.kt)("p",null,"For Gitcoin grants projects you can find the id of a project by going to the ",(0,o.kt)("a",{parentName:"p",href:"https://grants-stack-indexer-v2.gitcoin.co/graphiql"},"Gitcoin graphQL API")," and running a query like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},'query {\n  projects(\n    filter: {tags: {contains: "allo-v2"}, projectType: {equalTo: CANONICAL}, not: {tags: {contains: "program"}}, rounds: {every: {applicationsExist: true}}}\n    condition: {name: "{name of project}"}\n  ) {\n    id\n    name\n  }\n}\n\n')),(0,o.kt)("p",null,"This will give you a hash like ",(0,o.kt)("inlineCode",{parentName:"p"},"0x7f4b4b6cecc3bdaf95098ea2b2f5cd9c31ea742880d5076b540f83caf8247e16")," that you should use for the project Id when attesting to a Gitcoin project."),(0,o.kt)("h4",{id:"retro-funding-4"},"Retro Funding 4"),(0,o.kt)("p",null,"For Retro Funding projects you can find the id of a project by going to the ",(0,o.kt)("a",{parentName:"p",href:"https://round4-api-eas.retrolist.app/projects"},"Retrolist projects API"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"https://round4-api-eas.retrolist.app/projects\n")),(0,o.kt)("p",null,"the response on this page will be a very large JSON file which can be parsed to find the project ID you need to use for the attestation."),(0,o.kt)("h3",{id:"vouch"},"Vouch"),(0,o.kt)("p",null,"This is a simple true/false value, vouching = true, flagging = false."),(0,o.kt)("h3",{id:"comment"},"Comment"),(0,o.kt)("p",null,"This is a text comment that will be displayed on the DeVouch UI next to the associated attestation. This should be limited to 256 characters for it to be shown appropriately on the DeVouch UI and to limit gas expenses on submitting the transaction."),(0,o.kt)("h3",{id:"referenced-attestations"},"Referenced Attestations"),(0,o.kt)("p",null,"This is an important part where you associate the attestations with an attester organization. You'll need to get the attestation UID that links the attester organization relation to the attestation. Look at this example below in the easscan UI:"),(0,o.kt)("img",{alt:"easscan view of attester org referencing",src:(0,i.Z)("img/devouch/exampleAttesterOrgReference.png")}),(0,o.kt)("p",null,"This for example is used to associate ",(0,o.kt)("inlineCode",{parentName:"p"},"divinecomedian.eth")," as an RPGF3 Badgeholder, you can see the attestation UID near the top of the page. This is the value you need to use in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Referenced Attestations")," field."),(0,o.kt)("h3",{id:"ready-to-submit"},"Ready to submit!"),(0,o.kt)("p",null,"When you have all those fields filled out, you can submit the attestation to the blockchain. Once it is confirmed, it will be indexed by DeVouch and show up on the DeVouch UI and graphQL API."),(0,o.kt)("h2",{id:"adding-your-attester-group-to-devouch"},"Adding your Attester Group to DeVouch"),(0,o.kt)("p",null,"In order to add your attester group to DeVouch there's a few steps you need to take:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Fork the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/Giveth/DeVouch-BE"},"DeVouch BE repo on Github")),(0,o.kt)("li",{parentName:"ol"},"Make a ",(0,o.kt)("inlineCode",{parentName:"li"},"org-config.jsonc")," config file by copying from ",(0,o.kt)("inlineCode",{parentName:"li"},"org-config.template.jsonc"),".\na. Change the ",(0,o.kt)("inlineCode",{parentName:"li"},"name")," variable to the name of your attester group.\nb. Change the ",(0,o.kt)("inlineCode",{parentName:"li"},"schemaId")," variable to the schema ID of the attestations related to your organization\nc. Change the ",(0,o.kt)("inlineCode",{parentName:"li"},"authorizedAttestor")," variable to the address authorized to add addresses to your attester group or whoever the issuer is/was of the valid attestations.\nd. Ensure the ",(0,o.kt)("inlineCode",{parentName:"li"},"network")," variable is set to the correct network. ",(0,o.kt)("inlineCode",{parentName:"li"},"eth-sepolia")," for testing, ",(0,o.kt)("inlineCode",{parentName:"li"},"optimism-mainnet")," for production.\ne. Optional to change the ",(0,o.kt)("inlineCode",{parentName:"li"},"color")," variable to a hex colour value that will be associated with your attester group & shown on the UI.\nf. Optional to set ",(0,o.kt)("inlineCode",{parentName:"li"},"startBlock")," to the block number you want to start indexing attestations from. This is useful if you have attestation in the past that you want to index. If so, the ",(0,o.kt)("inlineCode",{parentName:"li"},"startBlcock")," should the block number of the first attestation you want to index."),(0,o.kt)("li",{parentName:"ol"},"Run the script with ",(0,o.kt)("inlineCode",{parentName:"li"},"node add-organisation.js"),". You should noticy a new migration file was made under the ",(0,o.kt)("inlineCode",{parentName:"li"},"db/migrations")," folder."),(0,o.kt)("li",{parentName:"ol"},"Create a PR to the main DeVouch BE repo with your changes."),(0,o.kt)("li",{parentName:"ol"},"Wait for Approval and merging from the DeVouch team.")),(0,o.kt)("h2",{id:"overview-of-the-devouch-graphql-api--cookbook"},"Overview of the DeVouch Graphql API & Cookbook"),(0,o.kt)("p",null,"The DeVouch Graphql API is an accessible endpoint that allows you to query for any information from the DeVouch indexer. There are two endpoints available: "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Staging/Sepolia: ",(0,o.kt)("a",{parentName:"li",href:"https://backend.devouch.xyz/graphql"},"https://backend.devouch.xyz/graphql")),(0,o.kt)("li",{parentName:"ul"},"Production/Optimism Mainnet: ",(0,o.kt)("a",{parentName:"li",href:"https://optimism.backend.devouch.xyz/graphql"},"https://optimism.backend.devouch.xyz/graphql"))),(0,o.kt)("p",null,"The graphQL API is hyper flexible and provides a nearly unlimited amount of ways to query data. The rest of this document will be dedicated to providing examples of how to query the DeVouch API. "),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Fetching All Projects"),(0,o.kt)("p",null,"This query will fetch ",(0,o.kt)("strong",{parentName:"p"},"information for all projects")," listed on DeVouch. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"query MyQuery {\n  projects {\n    id\n    image\n    description\n    projectId\n    source\n    title\n    totalAttests\n    totalFlags\n    totalVouches\n  }\n}\n")),(0,o.kt)("p",null,"To query for ",(0,o.kt)("strong",{parentName:"p"},"projects from a specific source"),", you can add a ",(0,o.kt)("inlineCode",{parentName:"p"},"where")," clause to the query like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},'query MyQuery {\n  projects(where: {source_eq: "giveth"}) {\n    id\n    image\n    description\n    projectId\n    source\n    title\n    totalAttests\n    totalFlags\n    totalVouches\n  }\n}\n')),(0,o.kt)("p",null,"To query for ",(0,o.kt)("strong",{parentName:"p"},"projects that have only received attestations from a specific attester group"),", you'll need the schemaID associated with the attester group. When you have this you can make a quiery like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},'query {\n  projectAttestations (where:{\n    attestorOrganisation:{\n      organisation:{\n        id_eq: "0xf63f2a7159ee674aa6fce42196a8bb0605eafcf20c19e91a7eafba8d39fa0404"\n      }\n    }\n  }) {\n    project {\n      id\n      title\n    }\n    }\n  }\n')),(0,o.kt)("p",null,"Search all projects for ",(0,o.kt)("strong",{parentName:"p"},"keyword match")," in title: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},'{\n  projects(where: {title_containsInsensitive: "blockchain"}) {\n    totalFlags\n    totalVouches\n    title\n    source\n    description\n    slug\n    attestedOrganisations {\n      id\n      count\n      vouch\n  \n    }\n  }\n}\n'))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Fetching Information for a specific Project"),(0,o.kt)("p",null,"To query the Attestation data made to a specific project you will need to know the source platform and the project ID. Once you have that you can query attestation data like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},'query {\n  projects(where: {source_eq: "rf4", projectId_eq: "0x897d6172efca2d24a6b14f235db5127f7d747d923287ede38d776126bf02cbfe"}) {\n    id\n    source\n    projectId\n    totalFlags\n    totalVouches\n    attests {\n      vouch\n      comment\n      attestorOrganisation {\n        attestor {\n          id\n        }\n        organisation {\n          id\n          name\n        }\n      }\n    }\n  }\n}\n\n')),(0,o.kt)("p",null,"Note: Inside of the ",(0,o.kt)("inlineCode",{parentName:"p"},"attests")," field you can query for the ",(0,o.kt)("inlineCode",{parentName:"p"},"attestor")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"organisation")," entities. The organisation refers to the attester group associated with the attestation. The attestor is the user that made the attestation and it's ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," is their address.")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Fetching Information about a specific attester"),"To fetch information about a specific attestor you'll need their address, then you can query like this:",(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},'{\n  projectAttestations(where: {attestorOrganisation: {attestor: {id_eq: "0x826976d7c600d45fb8287ca1d7c76fc8eb732030"}}}) {\n    attestTimestamp\n    comment\n    vouch\n    project {\n      id\n      title\n    }\n    attestorOrganisation {\n      attestor {\n        id\n      }\n      attestTimestamp\n      organisation {\n        name\n      }\n    }\n  }\n}\n')),(0,o.kt)("p",null,"This response provided all the attestations made by the attestor with the address ",(0,o.kt)("inlineCode",{parentName:"p"},"0x826976d7c600d45fb8287ca1d7c76fc8eb732030"),". This include which projects they attested to, the details of the attestation, the attester group they used and the timestamp they attested.")))}p.isMDXComponent=!0}}]);